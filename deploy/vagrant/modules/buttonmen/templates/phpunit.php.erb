<?php
/* 
 * Run all unit tests on a vagrant system
 * Modelled on /usr/bin/phpunit CLI utility
 */

// Include /etc/php5/deploy-includes for phpunit itself.
// Include /buttonmen/src for now, so the individual unit tests can find the base classes
set_include_path( "/etc/php/7.0/deploy-includes:/buttonmen/src:" . ini_get( "include_path" ) );

$BM_RAND_VALS = array();
$BM_SKILL_RAND_VALS = array();
$BM_RAND_REQUIRE_OVERRIDE = FALSE;

function bm_rand($min = FALSE, $max = FALSE) {
    global $BM_RAND_VALS, $BM_RAND_REQUIRE_OVERRIDE;

    if (count($BM_RAND_VALS) > 0) {
        return array_shift($BM_RAND_VALS);
    }
    if ($BM_RAND_REQUIRE_OVERRIDE) {
        throw new Exception("Called bm_rand() from a test requiring overrides, but BM_RAND_VALS is empty");
    }

    if (is_numeric($min) && is_numeric($max)) {
        return mt_rand($min, $max);
    }
    return mt_rand();
}

function bm_skill_rand($min = FALSE, $max = FALSE) {
    global $BM_SKILL_RAND_VALS, $BM_RAND_REQUIRE_OVERRIDE;

    if (count($BM_SKILL_RAND_VALS) > 0) {
        return array_shift($BM_SKILL_RAND_VALS);
    }
    if ($BM_RAND_REQUIRE_OVERRIDE) {
        throw new Exception("Called bm_skill_rand() from a test requiring overrides, but BM_SKILL_RAND_VALS is empty");
    }

    if (is_numeric($min) && is_numeric($max)) {
        return mt_rand($min, $max);
    }
    return mt_rand();
}

// Unit tests use the same bootstrap file as the code itself
require_once( "/buttonmen/src/lib/bootstrap.php" );
